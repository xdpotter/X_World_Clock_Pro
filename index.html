<!DOCTYPE ahtml>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XWorld Clock Pro</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8173211580426362"
     crossorigin="anonymous"></script>
    <!-- Load Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Global styles for the "Pro" dark theme */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Very dark background, GitHub style */
            color: #ffffff;
            min-height: 100vh;
        }

        /* Utility class for a sharp, vibrant button */
        .vibrant-btn {
            background-color: #10b981; /* Emerald 500 */
            color: #0d1117;
            font-weight: 700;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }
        .vibrant-btn:hover {
            background-color: #059669; /* Emerald 600 */
            transform: translateY(-1px);
        }
        
        /* Custom styles for the comparison clocks to use background effects */
        .clock {
            transition: all 0.3s ease-in-out;
            border: 2px solid transparent;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
        }

        .clock.day {
            background: linear-gradient(135deg, #1d4ed8, #3b82f6); /* Blue tones */
        }
        
        .clock.night {
            background: linear-gradient(135deg, #4c1d95, #7c3aed); /* Purple tones */
        }
        
        /* Highlight focus rings with primary color */
        input:focus, select:focus {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            outline: none;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header Section -->
    <header class="sticky top-0 z-10 bg-gray-900 border-b border-gray-700 shadow-xl p-4 md:p-6 text-center">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-4xl md:text-5xl font-extrabold text-blue-400 mb-2 tracking-tight">
                üåç XWorld Clock Pro
            </h1>
            <div id="local-time" class="text-xl font-mono text-emerald-400 mb-4">
                <!-- Local time displayed here -->
                Loading Local Time...
            </div>
            
            <!-- Search Input -->
            <div class="relative max-w-lg mx-auto">
                <input type="text" id="search" placeholder="Search city or country (e.g., London, India)..." 
                       class="w-full p-3 pl-10 bg-gray-800 text-white border border-gray-700 rounded-full text-base placeholder-gray-500 transition duration-200"
                       oninput="searchCities(this.value)">
                <!-- Search Icon -->
                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto p-4 md:p-8">
        
        <!-- Time Difference Calculator Section (New Feature) -->
        <section id="difference-section" class="mb-12 p-6 bg-gray-800 rounded-xl shadow-2xl border border-gray-700">
            <h2 class="text-3xl font-bold text-yellow-400 mb-6 flex items-center">
                <span class="mr-2">‚è±Ô∏è</span> Time Difference Calculator
            </h2>
            <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                
                <div class="flex flex-col items-center w-full sm:w-1/2">
                    <label class="text-gray-400 mb-1 font-medium">Select Country/Zone to Compare</label>
                    <select id="diff-zone" onchange="calculateDifference()" 
                            class="p-3 rounded-lg bg-gray-700 text-white border border-gray-600 w-full text-center">
                        <option value="">-- Select a Time Zone --</option>
                        <!-- Options populated by JS -->
                    </select>
                </div>
            </div>
            
            <div id="difference-result" class="mt-6 text-center">
                <!-- Result will be displayed here -->
                <p class="text-xl text-gray-400">Select a zone to see the difference from your local time.</p>
            </div>
        </section>

        <!-- Search Results Grid -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">Search Results</h2>
            <div id="results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- City cards inserted here -->
            </div>
        </section>

        <!-- Time Comparison Section -->
        <section id="compare-section" class="mb-12 p-6 bg-gray-800 rounded-xl shadow-2xl border border-gray-700">
            <h2 class="text-3xl font-bold text-pink-400 mb-6 flex items-center">
                <span class="mr-2">üïí</span> Multi-City Comparison
            </h2>
            <div id="compare" class="flex flex-wrap justify-center gap-6">
                <div id="compare-placeholder" class="text-gray-400 p-8 text-center border border-dashed border-gray-700 rounded-lg w-full">
                    Click "Compare" on a city above to add it here. (Max 3)
                </div>
            </div>
        </section>
        
    </main>

    <!-- Footer -->
    <footer class="text-center p-4 mt-12 border-t border-gray-800 text-gray-500">
        <p class="text-sm">Made with <span class="text-red-500">‚ù§Ô∏è</span> by Harshal | Note: Times are client-side simulated.</p>
    </footer>

    <script>
        // Placeholder for a potential API call (not used in this client-side version)
        const API_URL = "https://worldclock-api.onrender.com"; 

        // Comprehensive list of Time Zones based on user-provided countries and major cities
        // Each entry: [Friendly Name (for display), Time Zone String (IANA), Flag Emoji]
        const TIMEZONE_DATA = [
            ["Your Local Time", Intl.DateTimeFormat().resolvedOptions().timeZone, "üìç"],
            // Major/Pre-existing
            ["New York, USA", "America/New_York", "üá∫üá∏"],
            ["London, UK", "Europe/London", "üá¨üáß"],
            ["Mumbai, India", "Asia/Kolkata", "üáÆüá≥"],
            ["Tokyo, Japan", "Asia/Tokyo", "üáØüáµ"],
            ["Sydney, Australia", "Australia/Sydney", "üá¶üá∫"],
            ["Dubai, UAE", "Asia/Dubai", "üá¶üá™"],
            
            // Extensive list based on user request (Representative Zone/City selected)
            ["Afghanistan", "Asia/Kabul", "üá¶üá´"],
            ["Albania", "Europe/Tirane", "üá¶üá±"],
            ["Algeria", "Africa/Algiers", "üá©üáø"],
            ["American Samoa", "Pacific/Pago_Pago", "üá¶üá∏"],
            ["Andorra", "Europe/Andorra", "üá¶üá©"],
            ["Angola", "Africa/Luanda", "üá¶üá¥"],
            ["Anguilla", "America/Anguilla", "üá¶üáÆ"],
            ["Antigua and Barbuda", "America/Antigua", "üá¶üá¨"],
            ["Argentina (Buenos Aires)", "America/Argentina/Buenos_Aires", "üá¶üá∑"],
            ["Armenia", "Asia/Yerevan", "üá¶üá≤"],
            ["Aruba", "America/Aruba", "üá¶üáº"],
            ["Austria", "Europe/Vienna", "üá¶üáπ"],
            ["Azerbaijan", "Asia/Baku", "üá¶üáø"],
            ["The Bahamas", "America/Nassau", "üáßüá∏"],
            ["Bahrain", "Asia/Bahrain", "üáßüá≠"],
            ["Bangladesh", "Asia/Dhaka", "üáßüá©"],
            ["Barbados", "America/Barbados", "üáßüáß"],
            ["Belarus", "Europe/Minsk", "üáßüáæ"],
            ["Belgium", "Europe/Brussels", "üáßüá™"],
            ["Belize", "America/Belize", "üáßüáø"],
            ["Benin", "Africa/Porto-Novo", "üáßüáØ"],
            ["Bermuda", "Atlantic/Bermuda", "üáßüá≤"],
            ["Bhutan", "Asia/Thimphu", "üáßüáπ"],
            ["Bolivia", "America/La_Paz", "üáßüá¥"],
            ["Bosnia and Herzegovina", "Europe/Sarajevo", "üáßüá¶"],
            ["Botswana", "Africa/Gaborone", "üáßüáº"],
            ["Brazil (S√£o Paulo)", "America/Sao_Paulo", "üáßüá∑"],
            ["British Virgin Islands", "America/Tortola", "üáªüá¨"],
            ["Brunei", "Asia/Brunei", "üáßüá≥"],
            ["Bulgaria", "Europe/Sofia", "üáßüá¨"],
            ["Burkina Faso", "Africa/Ouagadougou", "üáßüá´"],
            ["Burundi", "Africa/Bujumbura", "üáßüáÆ"],
            ["Cabo Verde", "Atlantic/Cape_Verde", "üá®üáª"],
            ["Cambodia", "Asia/Phnom_Penh", "üá∞üá≠"],
            ["Cameroon", "Africa/Douala", "üá®üá≤"],
            ["Canada (Toronto)", "America/Toronto", "üá®üá¶"],
            ["Cayman Islands", "America/Cayman", "üá∞üáæ"],
            ["Central African Republic", "Africa/Bangui", "üá®üá´"],
            ["Chad", "Africa/Ndjamena", "üáπüá©"],
            ["Chile (Santiago)", "America/Santiago", "üá®üá±"],
            ["China (Shanghai)", "Asia/Shanghai", "üá®üá≥"],
            ["Cocos (Keeling) Islands", "Indian/Cocos", "üá®üá®"],
            ["Colombia", "America/Bogota", "üá®üá¥"],
            ["Comoros", "Indian/Comoro", "üá∞üá≤"],
            ["DR Congo (Kinshasa)", "Africa/Kinshasa", "üá®üá©"],
            ["Republic of the Congo", "Africa/Brazzaville", "üá®üá¨"],
            ["Cook Islands", "Pacific/Rarotonga", "üá®üá∞"],
            ["Costa Rica", "America/Costa_Rica", "üá®üá∑"],
            ["C√¥te d‚ÄôIvoire", "Africa/Abidjan", "üá®üáÆ"],
            ["Croatia", "Europe/Zagreb", "üá≠üá∑"],
            ["Cuba", "America/Havana", "üá®üá∫"],
            ["Cura√ßao", "America/Curacao", "üá®üáº"],
            ["Cyprus", "Asia/Nicosia", "üá®üáæ"],
            ["Czech Republic", "Europe/Prague", "üá®üáø"],
            ["Denmark", "Europe/Copenhagen", "üá©üá∞"],
            ["Djibouti", "Africa/Djibouti", "üá©üáØ"],
            ["Dominica", "America/Dominica", "üá©üá≤"],
            ["Dominican Republic", "America/Santo_Domingo", "üá©üá¥"],
            ["East Timor", "Asia/Dili", "üáπüá±"],
            ["Ecuador", "America/Guayaquil", "üá™üá®"],
            ["Egypt", "Africa/Cairo", "üá™üá¨"],
            ["El Salvador", "America/El_Salvador", "üá∏üáª"],
            ["Equatorial Guinea", "Africa/Malabo", "üá¨üá∂"],
            ["Eritrea", "Africa/Asmara", "üá™üá∑"],
            ["Estonia", "Europe/Tallinn", "üá™üá™"],
            ["Eswatini", "Africa/Mbabane", "üá∏üáø"],
            ["Ethiopia", "Africa/Addis_Ababa", "üá™üáπ"],
            ["Falkland Islands", "Atlantic/Stanley", "üá´üá∞"],
            ["Faroe Islands", "Atlantic/Faroe", "üá´üá¥"],
            ["Fiji", "Pacific/Fiji", "üá´üáØ"],
            ["Finland", "Europe/Helsinki", "üá´üáÆ"],
            ["France (Paris)", "Europe/Paris", "üá´üá∑"],
            ["French Guiana", "America/Cayenne", "üá¨üá´"],
            ["French Polynesia", "Pacific/Tahiti", "üáµüá´"],
            ["Gabon", "Africa/Libreville", "üá¨üá¶"],
            ["The Gambia", "Africa/Banjul", "üá¨üá≤"],
            ["Gaza Strip", "Asia/Gaza", "üáµüá∏"],
            ["Georgia", "Asia/Tbilisi", "üá¨üá™"],
            ["Germany (Berlin)", "Europe/Berlin", "üá©üá™"],
            ["Ghana", "Africa/Accra", "üá¨üá≠"],
            ["Gibraltar", "Europe/Gibraltar", "üá¨üáÆ"],
            ["Greece", "Europe/Athens", "üá¨üá∑"],
            ["Greenland (Nuuk)", "America/Nuuk", "üá¨üá±"],
            ["Grenada", "America/Grenada", "üá¨üá©"],
            ["Guadeloupe", "America/Guadeloupe", "üá¨üáµ"],
            ["Guam", "Pacific/Guam", "üá¨üá∫"],
            ["Guatemala", "America/Guatemala", "üá¨üáπ"],
            ["Guernsey", "Europe/Guernsey", "üá¨üá¨"],
            ["Guinea", "Africa/Conakry", "üá¨üá≥"],
            ["Guinea-Bissau", "Africa/Bissau", "üá¨üáº"],
            ["Guyana", "America/Guyana", "üá¨üáæ"],
            ["Haiti", "America/Port-au-Prince", "üá≠üáπ"],
            ["Honduras", "America/Tegucigalpa", "üá≠üá≥"],
            ["Hong Kong", "Asia/Hong_Kong", "üá≠üá∞"],
            ["Hungary", "Europe/Budapest", "üá≠üá∫"],
            ["Iceland", "Atlantic/Reykjavik", "üáÆüá∏"],
            ["Indonesia (Jakarta)", "Asia/Jakarta", "üáÆüá©"],
            ["Iran", "Asia/Tehran", "üáÆüá∑"],
            ["Iraq", "Asia/Baghdad", "üáÆüá∂"],
            ["Ireland", "Europe/Dublin", "üáÆüá™"],
            ["Isle of Man", "Europe/Isle_of_Man", "üáÆüá≤"],
            ["Israel", "Asia/Jerusalem", "üáÆüá±"],
            ["Italy (Rome)", "Europe/Rome", "üáÆüáπ"],
            ["Jamaica", "America/Jamaica", "üáØüá≤"],
            ["Jersey", "Europe/Jersey", "üáØüá™"],
            ["Jordan", "Asia/Amman", "üáØüá¥"],
            ["Kazakhstan (Almaty)", "Asia/Almaty", "üá∞üáø"],
            ["Kenya", "Africa/Nairobi", "üá∞üá™"],
            ["Kiribati", "Pacific/Tarawa", "üá∞üáÆ"],
            ["North Korea", "Asia/Pyongyang", "üá∞üáµ"],
            ["South Korea (Seoul)", "Asia/Seoul", "üá∞üá∑"],
            ["Kosovo", "Europe/Tirane", "üáΩüá∞"],
            ["Kuwait", "Asia/Kuwait", "üá∞üáº"],
            ["Kyrgyzstan", "Asia/Bishkek", "üá∞üá¨"],
            ["Laos", "Asia/Vientiane", "üá±üá¶"],
            ["Latvia", "Europe/Riga", "üá±üáª"],
            ["Lebanon", "Asia/Beirut", "üá±üáß"],
            ["Lesotho", "Africa/Maseru", "üá±üá∏"],
            ["Liberia", "Africa/Monrovia", "üá±üá∑"],
            ["Libya", "Africa/Tripoli", "üá±üáæ"],
            ["Liechtenstein", "Europe/Vaduz", "üá±üáÆ"],
            ["Lithuania", "Europe/Vilnius", "üá±üáπ"],
            ["Luxembourg", "Europe/Luxembourg", "üá±üá∫"],
            ["Macau", "Asia/Macau", "üá≤üá¥"],
            ["Madagascar", "Indian/Antananarivo", "üá≤üá¨"],
            ["Malawi", "Africa/Blantyre", "üá≤üáº"],
            ["Malaysia (Kuala Lumpur)", "Asia/Kuala_Lumpur", "üá≤üáæ"],
            ["Maldives", "Indian/Maldives", "üá≤üáª"],
            ["Mali", "Africa/Bamako", "üá≤üá±"],
            ["Malta", "Europe/Malta", "üá≤üáπ"],
            ["Marshall Islands", "Pacific/Majuro", "üá≤üá≠"],
            ["Martinique", "America/Martinique", "üá≤üá∂"],
            ["Mauritania", "Africa/Nouakchott", "üá≤üá∑"],
            ["Mauritius", "Indian/Mauritius", "üá≤üá∫"],
            ["Mayotte", "Indian/Mayotte", "üáæüáπ"],
            ["Mexico (Mexico City)", "America/Mexico_City", "üá≤üáΩ"],
            ["Micronesia (Chuuk)", "Pacific/Chuuk", "üá´üá≤"],
            ["Moldova", "Europe/Chisinau", "üá≤üá©"],
            ["Monaco", "Europe/Monaco", "üá≤üá®"],
            ["Mongolia (Ulaanbaatar)", "Asia/Ulaanbaatar", "üá≤üá≥"],
            ["Montenegro", "Europe/Podgorica", "üá≤üá™"],
            ["Montserrat", "America/Montserrat", "üá≤üá∏"],
            ["Morocco", "Africa/Casablanca", "üá≤üá¶"],
            ["Mozambique", "Africa/Maputo", "üá≤üáø"],
            ["Myanmar (Yangon)", "Asia/Yangon", "üá≤üá≤"],
            ["Namibia", "Africa/Windhoek", "üá≥üá¶"],
            ["Nauru", "Pacific/Nauru", "üá≥üá∑"],
            ["Nepal", "Asia/Kathmandu", "üá≥üáµ"],
            ["Netherlands", "Europe/Amsterdam", "üá≥üá±"],
            ["New Caledonia", "Pacific/Noumea", "üá≥üá®"],
            ["New Zealand (Auckland)", "Pacific/Auckland", "üá≥üáø"],
            ["Nicaragua", "America/Managua", "üá≥üáÆ"],
            ["Niger", "Africa/Niamey", "üá≥üá™"],
            ["Nigeria (Lagos)", "Africa/Lagos", "üá≥üá¨"],
            ["Niue", "Pacific/Niue", "üá≥üá∫"],
            ["North Macedonia", "Europe/Skopje", "üá≤üá∞"],
            ["Northern Mariana Islands", "Pacific/Saipan", "üá≤üáµ"],
            ["Norway", "Europe/Oslo", "üá≥üá¥"],
            ["Oman", "Asia/Muscat", "üá¥üá≤"],
            ["Pakistan (Karachi)", "Asia/Karachi", "üáµüá∞"],
            ["Palau", "Pacific/Palau", "üáµüáº"],
            ["Panama", "America/Panama", "üáµüá¶"],
            ["Papua New Guinea", "Pacific/Port_Moresby", "üáµüá¨"],
            ["Paraguay", "America/Asuncion", "üáµüáæ"],
            ["Peru", "America/Lima", "üáµüá™"],
            ["Philippines (Manila)", "Asia/Manila", "üáµüá≠"],
            ["Pitcairn Island", "Pacific/Pitcairn", "üáµüá≥"],
            ["Poland", "Europe/Warsaw", "üáµüá±"],
            ["Portugal (Lisbon)", "Europe/Lisbon", "üáµüáπ"],
            ["Puerto Rico", "America/Puerto_Rico", "üáµüá∑"],
            ["Qatar", "Asia/Qatar", "üá∂üá¶"],
            ["R√©union", "Indian/Reunion", "üá∑üá™"],
            ["Romania", "Europe/Bucharest", "üá∑üá¥"],
            ["Russia (Moscow)", "Europe/Moscow", "üá∑üá∫"],
            ["Rwanda", "Africa/Kigali", "üá∑üáº"],
            ["Saint Helena", "Atlantic/St_Helena", "üá∏üá≠"],
            ["Saint Kitts and Nevis", "America/St_Kitts", "üá∞üá≥"],
            ["Saint Lucia", "America/St_Lucia", "üá±üá®"],
            ["Saint-Pierre and Miquelon", "America/Miquelon", "üáµüá≤"],
            ["Saint Vincent and the Grenadines", "America/St_Vincent", "üáªüá®"],
            ["Samoa", "Pacific/Apia", "üáºüá∏"],
            ["San Marino", "Europe/San_Marino", "üá∏üá≤"],
            ["Sao Tome and Principe", "Africa/Sao_Tome", "üá∏üáπ"],
            ["Saudi Arabia", "Asia/Riyadh", "üá∏üá¶"],
            ["Senegal", "Africa/Dakar", "üá∏üá≥"],
            ["Serbia", "Europe/Belgrade", "üá∑üá∏"],
            ["Seychelles", "Indian/Mahe", "üá∏üá®"],
            ["Sierra Leone", "Africa/Freetown", "üá∏üá±"],
            ["Singapore", "Asia/Singapore", "üá∏üá¨"],
            ["Sint Maarten", "America/Lower_Antilles", "üá∏üáΩ"],
            ["Slovakia", "Europe/Bratislava", "üá∏üá∞"],
            ["Slovenia", "Europe/Ljubljana", "üá∏üáÆ"],
            ["Solomon Islands", "Pacific/Guadalcanal", "üá∏üáß"],
            ["Somalia", "Africa/Mogadishu", "üá∏üá¥"],
            ["South Africa (Johannesburg)", "Africa/Johannesburg", "üáøüá¶"],
            ["Spain (Madrid)", "Europe/Madrid", "üá™üá∏"],
            ["Sri Lanka", "Asia/Colombo", "üá±üá∞"],
            ["South Sudan", "Africa/Juba", "üá∏üá∏"],
            ["Sudan", "Africa/Khartoum", "üá∏üá©"],
            ["Suriname", "America/Paramaribo", "üá∏üá∑"],
            ["Sweden", "Europe/Stockholm", "üá∏üá™"],
            ["Switzerland", "Europe/Zurich", "üá®üá≠"],
            ["Syria", "Asia/Damascus", "üá∏üáæ"],
            ["Taiwan", "Asia/Taipei", "üáπüáº"],
            ["Tajikistan", "Asia/Dushanbe", "üáπüáØ"],
            ["Tanzania", "Africa/Dar_es_Salaam", "üáπüáø"],
            ["Thailand (Bangkok)", "Asia/Bangkok", "üáπüá≠"],
            ["Togo", "Africa/Lome", "üáπüá¨"],
            ["Tokelau", "Pacific/Fakaofo", "üáπüá∞"],
            ["Tonga", "Pacific/Tongatapu", "üáπüá¥"],
            ["Trinidad and Tobago", "America/Port_of_Spain", "üáπüáπ"],
            ["Tunisia", "Africa/Tunis", "üáπüá≥"],
            ["Turkey (Istanbul)", "Europe/Istanbul", "üáπüá∑"],
            ["Turkmenistan", "Asia/Ashgabat", "üáπüá≤"],
            ["Tuvalu", "Pacific/Funafuti", "üáπüáª"],
            ["Turks and Caicos Islands", "America/Grand_Turk", "üáπüá®"],
            ["Uganda", "Africa/Kampala", "üá∫üá¨"],
            ["Ukraine (Kyiv)", "Europe/Kyiv", "üá∫üá¶"],
            ["United States (New York)", "America/New_York", "üá∫üá∏"],
            ["US Virgin Islands", "America/St_Thomas", "üáªüáÆ"],
            ["Uruguay", "America/Montevideo", "üá∫üáæ"],
            ["Uzbekistan", "Asia/Tashkent", "üá∫üáø"],
            ["Vanuatu", "Pacific/Vanuatu", "üáªüá∫"],
            ["Vatican City", "Europe/Vatican", "üáªüá¶"],
            ["Venezuela", "America/Caracas", "üáªüá™"],
            ["Vietnam", "Asia/Ho_Chi_Minh", "üáªüá≥"],
            ["Wallis and Futuna", "Pacific/Wallis", "üáºüá´"],
            ["Western Sahara", "Africa/El_Aaiun", "üá™üá≠"],
            ["Yemen", "Asia/Aden", "üáæüá™"],
            ["Zambia", "Africa/Lusaka", "üáøüá≤"],
            ["Zimbabwe", "Africa/Harare", "üáøüáº"],
        ];

        const TIMEZONE_MAPPING = TIMEZONE_DATA.map(([name, zone, flag], id) => ({ id: id + 1, name, zone, flag }));

        let comparedCities = [];
        let timeUpdateInterval;

        // 1. Utility Functions
        
        /** * Formats time for a given zone.
         * @param {string} zone - IANA time zone identifier.
         * @returns {string} Formatted time string.
         */
        function getCurrentTime(zone) {
            return new Date().toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: zone,
                hour12: true
            });
        }

        /** * Checks if it's day or night in the zone based on the hour.
         * @param {string} zone - IANA time zone identifier.
         * @returns {boolean} True if it's daytime (6 AM to 6 PM).
         */
        function isDaytime(zone) {
            const hour = parseInt(new Date().toLocaleTimeString('en-US', {
                hour: 'numeric',
                timeZone: zone,
                hour12: false
            }), 10);
            return hour >= 6 && hour < 18;
        }


        // 2. Rendering Functions

        /** Renders a single city result card. */
        function renderResultCard(city) {
            // Skip "Your Local Time" for the main search results view
            if (city.zone === Intl.DateTimeFormat().resolvedOptions().timeZone && city.name === "Your Local Time") {
                return '';
            }

            const isCompared = comparedCities.some(c => c.id === city.id);
            const timeClass = isDaytime(city.zone) ? 'text-blue-400' : 'text-purple-400';
            
            return `
                <div class="result bg-gray-700 hover:bg-gray-600 p-4 rounded-xl shadow-lg transition duration-200 transform hover:scale-[1.02] border ${isCompared ? 'border-pink-500' : 'border-gray-700'}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="flag text-2xl mr-2">${city.flag}</span>
                            <h3 class="text-xl font-semibold">${city.name.split(',')[0].replace(/\s+\(.*?\)/g, '')}</h3>
                        </div>
                        <button 
                            onclick="toggleCompare(${city.id})" 
                            class="text-sm font-semibold rounded-full px-3 py-1 transition duration-150 ${isCompared ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-blue-500 hover:bg-blue-600 text-white'}">
                            ${isCompared ? 'Remove' : 'Compare'}
                        </button>
                    </div>
                    <p class="current-time text-3xl font-bold font-mono mt-2 ${timeClass}" data-zone="${city.zone}">
                        ${getCurrentTime(city.zone)}
                    </p>
                    <p class="text-sm text-gray-400">${city.zone}</p>
                </div>
            `;
        }
        
        /** Renders a single comparison clock. */
        function renderCompareClock(city) {
            const timeClass = isDaytime(city.zone) ? 'day' : 'night';
            const locationName = city.name.split(',')[0].replace(/\s+\(.*?\)/g, ''); // Clean up name for display

            return `
                <div class="clock ${timeClass} w-full sm:w-60 p-5 rounded-xl text-center text-white flex flex-col items-center justify-center">
                    <span class="text-4xl mb-2">${city.flag}</span>
                    <h3 class="text-xl font-semibold mb-1">${locationName}</h3>
                    <p class="current-time text-4xl font-extrabold font-mono" data-zone="${city.zone}">
                        ${getCurrentTime(city.zone)}
                    </p>
                    <p class="text-sm opacity-80">${city.zone.split('/')[1]?.replace('_', ' ') || "Local"}</p>
                    <button onclick="toggleCompare(${city.id})" class="text-xs mt-3 bg-red-400 hover:bg-red-500 py-1 px-3 rounded-full font-medium transition">Remove</button>
                </div>
            `;
        }

        /** Updates the time displayed on all clock elements in the DOM. */
        function updateAllClocks() {
            document.querySelectorAll('.current-time').forEach(el => {
                const zone = el.dataset.zone;
                if (zone) {
                    el.textContent = getCurrentTime(zone);
                }
            });
            updateLocalTime();
        }
        
        /** Updates the local time display (used in the header). */
        function updateLocalTime() {
            document.getElementById('local-time').textContent = getCurrentTime(TIMEZONE_MAPPING[0].zone);
        }

        /** Renders the initial list of cities and the comparison clocks. */
        function renderAll() {
            // Use the current search input value to maintain the filter state
            searchCities(document.getElementById('search').value || '');
            
            // Render Comparison Clocks
            const compareContainer = document.getElementById('compare');
            const placeholderEl = document.getElementById('compare-placeholder');
            
            if (comparedCities.length === 0) {
                // Only re-create placeholder if it doesn't exist
                if (!placeholderEl) {
                     compareContainer.innerHTML = `<div id="compare-placeholder" class="text-gray-400 p-8 text-center border border-dashed border-gray-700 rounded-lg w-full">Click "Compare" on a city above to add it here. (Max 3)</div>`;
                }
            } else {
                compareContainer.innerHTML = comparedCities.map(renderCompareClock).join('');
            }
        }

        /** Populates the dropdown for the Time Difference Calculator. */
        function populateTimeDifferenceDropdown() {
            const diffSelect = document.getElementById('diff-zone');
            
            // Filter out the local time entry, as that is the reference point
            const zonesToShow = TIMEZONE_MAPPING.filter(c => c.zone !== TIMEZONE_MAPPING[0].zone);

            // Clear existing options first
            diffSelect.innerHTML = '<option value="">-- Select a Time Zone --</option>';

            zonesToShow.forEach(city => {
                // Clean up name for display in the small dropdown
                const name = city.name.replace(/, USA/g, '').replace(/\s+\(.*?\)/g, ''); 
                const option = new Option(`${city.flag} ${name}`, city.zone);
                option.dataset.name = name;
                diffSelect.add(option);
            });
        }
        
        // 3. Logic Functions

        /** Calculates and displays the time difference. */
        function calculateDifference() {
            const selectedZone = document.getElementById('diff-zone').value;
            const resultDiv = document.getElementById('difference-result');
            
            if (!selectedZone) {
                resultDiv.innerHTML = '<p class="text-xl text-gray-400">Select a zone to see the difference from your local time.</p>';
                return;
            }

            // --- Calculation Logic (Accurately determines time shift in hours) ---
            const localDate = new Date();
            const localOffsetHours = localDate.getTimezoneOffset() / 60; // Offset from UTC in hours

            // Get target time string and create a Date object interpreted in that zone
            const targetTimeStr = localDate.toLocaleString("en-US", { timeZone: selectedZone });
            const targetDate = new Date(targetTimeStr);

            // Calculate the target zone's offset from UTC (in minutes) by comparing its local time interpretation 
            // to the actual UTC time. This method accounts for Daylight Saving Time rules in the target zone.
            const targetOffsetMinutes = (targetDate.getTime() - localDate.getTime() - (localOffsetHours * 60 * 60 * 1000)) / 60000;
            
            // Total difference from local time (in hours)
            const diffHours = (targetOffsetMinutes / 60) + localOffsetHours;
            // ---------------------------------------------------------------------

            let diffText;
            // Use diffHours.toFixed(1) to handle half-hour offsets like India's (5.5)
            const diffAbs = Math.abs(diffHours).toFixed(1).replace('.0', ''); 

            if (diffHours === 0) {
                diffText = 'Same as your local time';
            } else if (diffHours > 0) {
                diffText = `${diffAbs} hours AHEAD`;
            } else {
                diffText = `${diffAbs} hours BEHIND`;
            }

            const city = TIMEZONE_MAPPING.find(c => c.zone === selectedZone);
            const locationName = city ? city.name.split(',')[0].replace(/\s+\(.*?\)/g, '') : selectedZone.split('/')[1]?.replace('_', ' ');

            resultDiv.innerHTML = `
                <p class="text-gray-400 text-xl mb-2">Time in ${locationName} is:</p>
                <p class="text-5xl font-extrabold font-mono text-blue-300">
                    ${diffText}
                </p>
                <p class="text-xl text-gray-500 mt-2">(${getCurrentTime(selectedZone)} vs ${getCurrentTime(TIMEZONE_MAPPING[0].zone)} Local)</p>
            `;
        }

        /** Handles the search input filtering. */
        function searchCities(query) {
            const filter = query.toLowerCase();
            
            // Filter out the local time entry for search results
            const searchableCities = TIMEZONE_MAPPING.slice(1); 

            const filteredCities = searchableCities.filter(city => 
                city.name.toLowerCase().includes(filter) || 
                city.zone.toLowerCase().includes(filter)
            );
            
            const resultsContainer = document.getElementById('results');
            if (filteredCities.length > 0) {
                // Re-render all cards, which also ensures the 'Compare'/'Remove' button state is correct
                resultsContainer.innerHTML = filteredCities.map(renderResultCard).join('');
            } else {
                resultsContainer.innerHTML = '<div class="col-span-full p-8 text-center text-gray-500">No matching time zones found.</div>';
            }
        }

        /** Toggles a city between the search results and the comparison section. */
        function toggleCompare(cityId) {
            const city = TIMEZONE_MAPPING.find(c => c.id === cityId);
            const index = comparedCities.findIndex(c => c.id === cityId);

            if (index > -1) {
                // Remove city
                comparedCities.splice(index, 1);
            } else if (comparedCities.length < 3) {
                // Add city
                comparedCities.push(city);
            } else {
                // Handle max limit via a temporary message box instead of alert()
                const messageBox = document.createElement('div');
                messageBox.className = 'fixed top-4 right-4 bg-red-600 text-white p-4 rounded-lg shadow-xl z-50 transition-opacity duration-300';
                messageBox.innerHTML = 'You can only compare a maximum of 3 cities.';
                document.body.appendChild(messageBox);
                setTimeout(() => messageBox.remove(), 3000);
            }
            
            // Crucial: Rerender all components to reflect the changes in both the search grid and the comparison section
            renderAll(); 
            updateAllClocks();
        }
        
        // 4. Initialization
        window.onload = function() {
            populateTimeDifferenceDropdown();
            renderAll(); 
            
            // FIX 1: Explicitly call updateAllClocks() once immediately to ensure 
            // the "Loading Local Time..." placeholder is replaced right away.
            updateAllClocks(); 

            // Start clock update interval
            timeUpdateInterval = setInterval(updateAllClocks, 1000);

            // Trigger difference calculation on load if a default is set
            // Default to London for immediate display
            const defaultZone = TIMEZONE_MAPPING.find(c => c.name.includes("London"));
            if (defaultZone) {
                document.getElementById('diff-zone').value = defaultZone.zone; 
                calculateDifference();
            }
        };
    </script>
</body>
</html>
